<button class="btn btn-info w-25 mb-5" hx-get="/section/new/{{.EngagementName}}" hx-swap="outerHTML">+</button>

{{range .Sections}}
<div hx-target="this">
	<div class="title d-flex justify-content-between align-items-center p-3">
		<div class="row g-3 d-flex align-items-center">
			<div class="col-auto row">
				<button class="btn btn-sm" hx-put="/section/up/{{$.EngagementName}}/{{.Key}}" hx-target="body">▲</button>
				<button class="btn btn-sm" hx-put="/section/down/{{$.EngagementName}}/{{.Key}}" hx-target="body">▼</button>
			</div>
			<h3 class="col-auto text-center">{{.Title}}</h3>
		</div>
		<div>
			<button class="btn btn-info px-4 py-2">Save</button>
			<button class="btn btn-warning px-4 py-2" hx-get="/section/update/{{$.EngagementName}}/{{.Key}}" hx-target="closest div">~</button>
			<button hx-delete="/section/{{$.EngagementName}}/{{.Key}}" hx-confirm='Are you sure you want to delete "{{.Title}}"' class="btn btn-danger px-4 py-2">-</button>
		</div>
	</div>

	  <div id="editor{{.Key}}"></div>
</div>
{{end}}

<script>
$(document).ready(function() {
  {{range .Sections}}
    setTimeout(function() {
	$('#editor{{.Key}}').summernote({
		height: 300,
		styleWithSpan: true,
	});
	$('#editor{{.Key}}').summernote('code', {{.Body}});

$('#editor{{.Key}}').on('summernote.blur', function() {
	const content = $('#editor{{.Key}}').summernote('code');

	var xhr = new XMLHttpRequest();
	xhr.open("PUT", "/section/body/{{$.EngagementName}}/{{.Key}}", true);
	xhr.setRequestHeader('Content-Type', 'application/json');
	xhr.send(JSON.stringify({
	    content: content
	}));
	});
    }, 10);
    
  {{end}}
});
</script>
